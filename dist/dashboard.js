var app=angular.module("dashboard",["ngAnimate","ui.router"]);app.run(["$rootScope","$state","$stateParams",function(e,a,t){e.$state=a,e.$on("$stateChangeStart",function(){$.ajax({type:"POST",url:"./index.php",data:{action:"session"},success:function(e){var e=e.trim();"false"===e&&"Register"!==a.current.name&&a.transitionTo("Login")}}),$("#fab").addClass("leave"),fabInterval=setTimeout(function(){$("#fab").removeClass("leave")},400),e.userData||$.ajax({type:"POST",url:"./index.php",data:{action:"session"},success:function(a){var a=a.trim();"false"!==a&&e.$apply(function(){e.userData=JSON.parse(a)})}})})}]).config(function(e,a){a.otherwise("/"),a.when("/dashboard","/dashboard/"),e.state("Login",{url:"/",templateUrl:"pages/login.html",data:{pageTitle:"Login"},onEnter:function(){componentHandler.upgradeAllRegistered()}}).state("Register",{url:"/register",templateUrl:"pages/register.html"}).state("Dashboard",{url:"/dashboard",templateUrl:"pages/dashboard.html",data:{pageTitle:"Dashboard"},onEnter:function(){}}).state("Dashboard.home",{url:"/",templateUrl:"pages/welcome.html",data:{childTitle:"Home"}}).state("Dashboard.schrijven",{url:"/vacature",templateUrl:"pages/vacature.html",data:{childTitle:"Vacature maken"}}).state("Dashboard.vacatures",{url:"/vacatures",templateUrl:"pages/vacatures.html",data:{childTitle:"Vacatures"}}).state("Dashboard.admins",{url:"/admins",templateUrl:"pages/admins.html",data:{childTitle:"Beheerders"}}).state("Dashboard.mijnGegevens",{url:"/Mijn gegevens",templateUrl:"pages/security.html",data:{childTitle:"Mijn gegevens"}}).state("Dashboard.reacties",{url:"/reacties",templateUrl:"pages/reacties.html",data:{childTitle:"Reacties"}}).state("Dashboard.sollicitanten",{url:"/users",templateUrl:"pages/sollicitanten.html",data:{childTitle:"Sollicitanten"}}).state("Dashboard.management",{url:"/management",templateUrl:"pages/management.html",data:{childTitle:"Management"}})}).controller("mainCtrl",["$scope","$state","$rootScope",function(e,a,t){function n(e){e===!0&&(e="Not logged in"),$("#toast").toggleClass("animate").children("#toastText").text(e),setTimeout(function(){$("#toast").toggleClass("animate")},3e3)}function r(e){setTimeout(function(){$("#fab").children().eq(0).html(e)},200)}e.state=a,e.updatingVacancy=!1,e.selectedJobFunction={},e.userSearchFilter="",e.finished=function(){componentHandler.upgradeAllRegistered()},e.loaded=function(){setTimeout(function(){componentHandler.upgradeAllRegistered()})},$(document).ajaxError(function(e,a,t){n("Server error")}),e.$on("$viewContentLoaded",function(e){function a(e){if(e instanceof Element&&e.matches(".mdl-textfield__input")===!0){var a=e.closest(".mdl-textfield"),t=0!==e.value.toString().length;if(null!==a)for(var n=a.getElementsByClassName("mdl-textfield__icon"),r=0;r<n.length;r++)t===!1&&e.isActive()!==!0?n[r].classList.remove("mdl-color-text--primary"):n[r].classList.add("mdl-color-text--primary")}}componentHandler.upgradeAllRegistered(),document.addEventListener("focus",function(e){a(e.target)},!0),document.addEventListener("change",function(e){a(e.target)},!0),document.addEventListener("input",function(e){a(e.target)},!0),document.addEventListener("blur",function(e){a(e.target)},!0);for(var t=document.getElementsByClassName("mdl-textfield__input"),n=0;n<t.length;n++)a(t[n]);Element.prototype.closest=function(e){if(this.matches(e)===!0)return this;var a=this.parentNode;return a instanceof Element?a.closest(e):a=null},Element.prototype.isActive=function(){return this===document.activeElement}}),e.login=function(){$("#progress").show(),$.ajax({type:"POST",url:"./index.php",data:{action:"login",email:$("#email").val(),password:$("#password").val(),userType:$("input[name='userType']:checked").val()},success:function(t){var t=t.trim();"false"!==t?(e.userData={},$("#loginError").removeClass("show"),$("#progress").hide(),e.$apply(function(){e.userData=JSON.parse(t)}),a.transitionTo("Dashboard"),n("U bent ingelogd as "+e.userData.userType)):($("#progress").hide(),$("#loginError").addClass("show"))}})},e.logout=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"logout"},success:function(t){var t=t.trim();"Uitgelogd"===t&&(n(t),delete e.userData,a.transitionTo("Login"))}})},e.contactMe=function(){document.location.href="mailto:abdallaroc@gmail.com?subject=Countdown app dashboard"},e.session=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"session"},success:function(e){}})},e.mainAction=function(){switch(a.current.name){case"Dashboard.home":a.transitionTo("Dashboard.schrijven");break;case"Dashboard.schrijven":e.vacatureMaken()}},e.vacatureMaken=function(){$("#postTitle").val()||$(".blogInputs").eq(0).toggleClass("is-invalid"),$("#vacatureBeschrijving").val()||$(".blogInputs").eq(1).toggleClass("is-invalid"),$("#vacatureEisen").val()||$(".blogInputs").eq(2).toggleClass("is-invalid"),$("#salaris").val()||$(".salarisField").toggleClass("is-invalid"),$("#postTitle").val()&&$("#vacatureBeschrijving").val()&&$("#vacatureEisen").val()&&$("#salaris").val()&&(e.updatingVacancy?$.ajax({type:"POST",url:"./index.php",data:{admin:!0,action:"vacaturesEditen",titel:$("#postTitle").val(),beschrijving:$("#vacatureBeschrijving").val(),eisen:$("#vacatureEisen").val(),functie:$("#functieDropdown").val(),salaris:$("#salaris").val(),vacatureID:e.vacatures[e.vacancyIndex].vacatureID},success:function(a){var a=a.trim();a&&(n("Vacature gewijzigd"),e.$apply(function(){e.updatingVacancy=!1,e.state.current.data.childTitle="Blog schrijven"}))}}):$.ajax({type:"POST",url:"./index.php",data:{action:"vacatureMaken",titel:$("#postTitle").val(),beschrijving:$("#vacatureBeschrijving").val(),eisen:$("#vacatureEisen").val(),functie:$("#functieDropdown").find("option:selected").attr("name"),salaris:$("#salaris").val()},success:function(e){var e=e.trim();n("false"!==e?"Vacature toegevoed":"Vacature niet toegevoegd")}}))},e.register=function(){var e=0;$(".formInput").each(function(){$(this).val()?e++:$(this).parent().toggleClass("is-invalid is-dirty")}),4==e&&($("#password").val()!==$("#passwordRepeat").val()?$(".passwordContainer").toggleClass("is-invalid"):$.ajax({type:"POST",url:"./index.php",data:{action:"addAdmin",admin:!0,name:$("#name").val(),email:$("#email").val(),password:$("#password").val()},success:function(e){var e=e.trim();e&&n("Admin toegevoegd")}}))},e.editVacancy=function(t){e.updatingVacancy=!0,e.vacancyIndex=t,a.transitionTo("Dashboard.schrijven")},e.fillEditorData=function(a){$(".blogInputs").addClass("is-dirty is-upgraded"),$("#postTitle").val(e.vacatures[a].titel).focus(),$("#salaris").val(e.vacatures[a].salaris),setTimeout(function(){$("#functieDropdown").val(e.vacatures[a].functienaam)}),$("#vacatureBeschrijving").val(e.vacatures[a].beschrijving),$("#vacatureEisen").val(e.vacatures[a].eisen)},e.cancelEditPost=function(){e.updatingVacancy=!1,e.state.current.data.childTitle="Blog schrijven",$(".blogInputFields").val(""),$(".blogInputs").removeClass("is-dirty is-upgraded")},e.deleteVacancy=function(a,t){var r=confirm("Weet u zeker dat u deze vacature wilt verwijderen?");1==r&&$.ajax({type:"POST",url:"./index.php",data:{action:"vacatureVerwijderen",bedrijf:!0,vacatureID:a},success:function(a){var a=a.trim();"true"===a?(e.$apply(function(){e.vacatures.splice(t,1)}),n("Post verwijderd")):"false"===a&&n("Post niet verwijderd")}})},e.$on("$stateChangeStart",function(){"Dashboard.schrijven"===a.current.name&&e.cancelEditPost(),"Register"===a.current.name,"Dashboard.sollicitanten"===a.current.name&&(e.requestedUserID=0)}),e.$on("$stateChangeSuccess",function(){"Dashboard.admins"==a.current.name&&i(),"Dashboard.vacatures"==a.current.name&&($("#fab").addClass("leave"),"bedrijf"===e.userData.userType?(e.fetchPrivateVacanies(),e.state.current.data.childTitle="Mijn vacatures"):e.fetchAllVacancies()),"Dashboard.sollicitanten"==a.current.name&&("sollicitant"===e.userData.userType?(n("Insufficient permission"),a.transitionTo("Dashboard.home"),$.ajax({type:"POST",url:"./index.php",data:{action:"log",fileName:"violation",message:"application"+e.userData.userID+" tried to view a company only page"}})):e.fetchAllUsers()),"Dashboard.reacties"===a.current.name&&("bedrijf"==e.userData.userType&&e.fetchAllReplies(),"admin"==e.userData.userType&&e.fetchVacancyPerApplicant()),"Dashboard.schrijven"===a.current.name&&"sollicitant"===e.userData.userType&&(n("Insufficient permission"),a.transitionTo("Dashboard.home"),$.ajax({type:"POST",url:"./index.php",data:{action:"log",fileName:"violation",message:"An applicant tried to view a company only page"}})),"Dashboard.management"===a.current.name&&("sollicitant"===e.userData.userType||"bedrijf"===e.userData.userType?(n("Insufficient permission"),a.transitionTo("Dashboard.home"),$.ajax({type:"POST",url:"./index.php",data:{action:"log",fileName:"violation",message:"An applicant or company tried to view an admin only page"}})):"admin"===e.userData.userType&&(e.fetchAllUsers(),e.fetchAllVacancies(),e.fetchAllCompanies()))});var i=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"listAdmins",admin:!0},success:function(a){e.$apply(function(){})}})};e.$on("$viewContentLoaded",function(t){switch(a.current.name){case"Login":$.ajax({type:"POST",url:"./index.php",data:{action:"session"},success:function(t){var t=t.trim();"false"!==t&&(e.$apply(function(){e.userData=JSON.parse(t),a.transitionTo("Dashboard")}),n("Welkom terug"))}});break;case"Dashboard.home":r("create");break;case"Dashboard.schrijven":r("publish"),e.loadFunctions(),e.updatingVacancy&&(e.state.current.data.childTitle="Vacature wijzigen",e.fillEditorData(e.vacancyIndex));break;case"Dashboard.vacatures":clearInterval(fabInterval),$("#fab").addClass("leave");break;case"Dashboard.admins":clearInterval(fabInterval),$("#fab").addClass("leave");break;case"Dashboard.mijnGegevens":clearInterval(fabInterval),$("#fab").addClass("leave"),"sollicitant"===e.userData.userType?$("#sollicitant").fadeIn():"bedrijf"===e.userData.userType&&$("#bedrijf").fadeIn(),$(".verplichtVeld").addClass("is-dirty is-upgraded"),$("#beschrijving").addClass("is-dirty is-upgraded"),e.icon="vpn_key",e.wrongPass=void 0;break;case"Dashboard.reacties":clearInterval(fabInterval),$("#fab").addClass("leave");break;case"Dashboard.sollicitanten":clearInterval(fabInterval),$("#fab").addClass("leave");break;case"Dashboard.applicant":clearInterval(fabInterval),$("#fab").addClass("leave")}}),e.checkPassword=function(){$("#spinner").show(),e.icon="",$.ajax({type:"POST",url:"./index.php",data:{action:"verifyPassword",admin:!0,password:$("#currentPassword").val()},success:function(a){var a=a.trim();$("#spinner").hide(),"true"===a?(e.icon="done",e.wrongPass=!1):"false"===a&&(e.wrongPass=!0,e.icon="warning"),e.$apply()}})},e.changePassword=function(){e.wrongPass||($("#passwordRepeat").val()===$("#password").val()?$.ajax({type:"POST",url:"./index.php",data:{action:"changePassword",current:$("#currentPassword").val(),password:$("#password").val()},success:function(e){var e=e.trim();n("true"===e?"Wachtwoord veranderd":"Wachtwoord niet veranderd")}}):$(".passwordContainer").toggleClass("is-invalid"))},e.loadFunctions=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"laadFuncties"},success:function(a){var a=a.trim();"false"!==a?e.$apply(function(){e.functions=JSON.parse(a)}):n("Functies niet geladen")}})},e.log=function(){},e.choose=function(a){e.chosen=!0,a===!0?(e.sollicitant=!0,e.imageUrl="images/defaultpf.png"):(e.sollicitant=!1,e.imageUrl="images/company.png")},e.imageUrl="images/defaultpf.png",e.registerUser=function(){var e=0,a=function(a){for(var t=0;t<$(a).length;t++)""===$(a+" input").eq(t).val()?$(a).eq(t).toggleClass("is-invalid"):e++},t=$("input[name='userType']:checked").val();a("#commonFields .verplichtVeld"),$("#password").val()!==$("#passwordRepeat").val()?$(".passwordContainer").toggleClass("is-invalid"):("sollicitant"==t&&(a("#sollicitant .verplichtVeld"),9==e?$.ajax({type:"POST",url:"./index.php",data:{action:"register",email:$("#email").val(),password:$("#password").val(),adres:$("#Adres").val(),postcode:$("#postcode").val(),plaats:$("#plaats").val(),telefoon:$("#phoneNumber").val(),voornaam:$("#voornaam").val(),achternaam:$("#achternaam").val(),geslacht:$("input[name='gender']:checked").val(),beschrijving:$("#beschrijving").val(),userType:t,profielFoto:$("#imageUrlInputs").val()},success:function(e){var e=e.trim();n("true"===e?"Geregistreerd":"Server fout melding")}}):n("Incompleet gegevens")),"bedrijf"==t&&(a("#bedrijf .verplichtVeld"),8==e?$.ajax({type:"POST",url:"./index.php",data:{action:"register",email:$("#email").val(),password:$("#password").val(),bedrijfNaam:$("#bedrijfNaam").val(),adres:$("#Adres").val(),postcode:$("#postcode").val(),plaats:$("#plaats").val(),telefoon:$("#phoneNumber").val(),userType:t,profielFoto:$("#imageUrlInputs").val()},success:function(e){var e=e.trim();n("true"===e?"Bedrijf geregistreerd":"Server fout melding")}}):n("Incompleet gegevens")))},e.modifyPersonalInformation=function(){var a=0,t=function(e){for(var t=0;t<$(e).length;t++)""===$(e+" input").eq(t).val()?$(e).eq(t).toggleClass("is-invalid"):a++};t("#commonFields .verplichtVeld"),"sollicitant"==e.userData.userType&&(t("#sollicitant .verplichtVeld"),6==a&&$.ajax({type:"POST",url:"./index.php",data:{action:"changeInfo",adres:$("#Adres").val(),postcode:$("#postcode").val(),plaats:$("#plaats").val(),telefoon:$("#phoneNumber").val(),voornaam:$("#voornaam").val(),achternaam:$("#achternaam").val()},success:function(e){var e=e.trim();n("false"!==e?"Gegevens gewijzigd":"Server error")}})),"bedrijf"==e.userData.userType&&(t("#bedrijf .verplichtVeld"),5==a&&$.ajax({type:"POST",url:"./index.php",data:{action:"changeInfo",bedrijfNaam:$("#bedrijfNaam").val(),adres:$("#Adres").val(),postcode:$("#postcode").val(),plaats:$("#plaats").val(),telefoon:$("#phoneNumber").val()},success:function(e){var e=e.trim();n("false"!==e?"Gegevens gewijzigd":"Server error")}}))},e.fetchAllVacancies=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"vacaturesLezen"},success:function(a){var a=a.trim();"false"!==a&&e.$apply(function(){e.vacatures=JSON.parse(a)})}})},e.fetchPrivateVacanies=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"priveVacaturesLezen"},success:function(a){var a=a.trim();"false"!==a&&e.$apply(function(){e.vacatures=JSON.parse(a)})}})},e.solliciteer=function(e){$.ajax({type:"POST",url:"./index.php",data:{action:"apply",vacatureID:e},success:function(e){var e=e.trim();n("false"!==e&&"duplicate"!==e?"Gesolliciteerd":"duplicate"===e?"Al Gesolliciteerd":"Sollicitatie mislukt")}})},e.mijnSollicitaties=function(){},e.fetchUserData=function(a){$.ajax({type:"POST",url:"./index.php",data:{action:"fetchUser",userID:a},success:function(a){var a=a.trim();"false"!==a&&e.$apply(function(){e.requestedUser=JSON.parse(a)})}})},e.forgotPassword=function(){""!==$("#email").val()?$.ajax({type:"POST",url:"./index.php",data:{action:"forgotPassword",email:$("#email").val()},success:function(a){var a=a.trim();"true"===a&&n("Wachtwoord reset link verstuurd"),"false"===a&&(n("Server error"),e.triggerForgot()),"DoesntExist"===a&&(n("Uw e-mail is niet bekend bij ons"),e.triggerForgot())}}):$(".emailWrapper").eq(0).toggleClass("is-invalid")},e.triggerForgot=function(){e.forgetPassword=!0,$("#aanvragen").show()},e.adminLogin=function(){e.adminSelected=!0,e.forgetPassword=!1,$("input[name='userType']:checked").val("Admin"),$("#aanvragen").hide()},e.normalLogin=function(){e.adminSelected=!1,e.forgetPassword=!1,$("input[name='userType']:checked").val("Bedrijf"),$("#aanvragen").hide()},e.fetchAllUsers=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"fetchAllUsers"},success:function(a){var a=a.trim();"false"!==a?e.$apply(function(){e.users=JSON.parse(a)}):n("Server error")}})},$(document).on("click",".phone",function(){var e=$(this).attr("data-clipboard-text");new Clipboard(".phone",{text:function(a){return e}});n("Telefoon nummer gekopieerd")});var s=[];e.replyToVacancy=function(e,a){for(var t=0;t<s.length;t++)e==s[t].applicationID&&(a=s[t].status);var r={action:"",applicationID:e};"pending"===a||"denied"===a?r.action="acceptApplication":r.action="denyApplication",$.ajax({type:"POST",url:"./index.php",data:r,success:function(t){var t=t.trim();"false"!==t&&"true"===t?("pending"===a||"denied"===a?(n("Geaccepteerd"),a="accepted"):(n("Geweigered"),a="denied"),s.push({applicationID:e,status:a})):(n("Server error"),s=[])}})},e.formatArray=function(e,a){var t={};for(elem in e)e[elem][a]in t?t[e[elem][a]].push(e[elem]):(t[e[elem][a]]=[],t[e[elem][a]].push(e[elem]));return t},e.fetchAllReplies=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"fetchAllReplies"}}).then(function(a){var a=a.trim();"false"!==a?(n("Reacties geladen"),e.replies=e.formatArray(JSON.parse(a),"titel")):n("Server error")})},e.fetchVacancyPerApplicant=function(){$.ajax({type:"POST",url:"./index.php",data:{action:"fetchVacancyPerApplicant",admin:!0}}).then(function(a){var a=a.trim();"false"!==a?(n("Vacatures geladen"),e.vacancies=e.formatArray(JSON.parse(a),"Voornaam")):n("Server error")})},e.goToUser=function(t){e.requestedUserID=t,a.transitionTo("Dashboard.sollicitanten")},e.keyUpsHandler=function(e){switch(e){case 27:$(".choiceCard").fadeToggle(),$("input[name='userType']:checked").val("Admin"),$(".hide").fadeToggle()}},e.fetchAllCompanies=function(){$.ajax({type:"POST",url:"./index.php",data:{admin:!0,action:"fetchAllCompanies"},success:function(a){var a=a.trim();"false"!==a?e.$apply(function(){e.companies=JSON.parse(a)}):n("Server error")}})},e.deleteCompany=function(a,t){var r=confirm("Wilt u dit bedrijf zeker verwijderen?");r&&$.ajax({type:"POST",url:"./index.php",data:{action:"deleteCompany",admin:!0,bedrijfID:a}}).then(function(a){var a=a.trim();"false"!==a?(n("Bedrijf verwijdered"),e.$apply(function(){e.companies.splice(t,1)})):n("Server error")})},e.deleteUser=function(a,t){var r=confirm("Wilt u deze gebruiker zeker verwijderen?");r&&$.ajax({type:"POST",url:"./index.php",data:{action:"deleteUser",admin:!0,userID:a}}).then(function(a){var a=a.trim();"false"!==a?(n("User verwijdered"),e.$apply(function(){e.users.splice(t,1)})):n("Server error")})},e.deleteVacancy=function(a,t){$("#vacatureProgress").show();var r=confirm("Wilt u deze vacature zeker verwijderen?");r&&$.ajax({type:"POST",url:"./index.php",data:{action:"deleteVacancy",admin:!0,vacatureID:a}}).then(function(a){var a=a.trim();"false"!==a?(n("Vacature verwijdered"),e.$apply(function(){e.vacatures.splice(t,1),$("#vacatureProgress").hide()})):n("Server error")})},e.resetFilter=function(){e.userSearchFilter="",e.requestedUserID=""},e.registerAdmin=function(){}}]);